<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery (for easier AJAX handling) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<!-- Header -->
<header class="bg-primary text-white text-center py-4">
    <h1>Our Products</h1>
    <p>Check out our latest products!</p>
</header>

<!-- Main Content -->
<main class="container my-5">
    <div class="row">
        <!-- Sidebar -->
        <aside class="col-md-3">
            <h2>Categories</h2>
            <ul class="list-group">
                <li class="list-group-item" data-category-id="1">Category 1</li>
                <li class="list-group-item" data-category-id="2">Category 2</li>
                <li class="list-group-item" data-category-id="3">Category 3</li>
                <li class="list-group-item" data-category-id="4">Category 4</li>
            </ul>
        </aside>

        <section class="col-md-9">
            <div id="product-list" class="row">
            </div>
            <!-- Pagination -->
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center" id="pagination">
                </ul>
            </nav>
        </section>
    </div>
</main>

<!-- Footer -->
<footer class="bg-dark text-white text-center py-3">
    <p>&copy; 2024 My Website. All Rights Reserved.</p>
</footer>


<script>
    $(document).ready(function () {
        // Load initial data for default category or category 1
        let currentCategoryId = 1;
        loadProducts(currentCategoryId, 0);

        // Function to load products
        function loadProducts(categoryId, page) {
            $.ajax({
                url: `/api/categories/${categoryId}`,
                method: 'GET',
                data: {page: page, size: 3},
                success: function (response) {
                    if (response.code === 200) {
                        const data = response.data;
                        const products = data.products;

                        $('#product-list').empty();
                        $('#pagination').empty();

                        // Append products to product list
                        products.forEach(function (product) {
                            $('#product-list').append(`
                                    <div class="col-md-4 mb-4">
                                        <div class="card">
                                            <img src="${product.thumbnail || 'default-image.jpg'}" class="card-img-top"
                                            alt="${product.name}" style="width: 100%; height: 200px; object-fit: cover;">
                                            <div class="card-body">
                                                <h5 class="card-title">${product.name}</h5>
                                                <p class="card-text">${product.description}</p>
                                                <p class="card-text">${product.price} Ïõê</p>
                                            </div>
                                        </div>
                                    </div>
                                `);
                        });

                        // Build pagination buttons
                        for (let i = 0; i < data.totalPages; i++) {
                            $('#pagination').append(`
                                    <li class="page-item ${i === page ? 'active' : ''}">
                                        <a class="page-link" href="#" data-page="${i}">${i + 1}</a>
                                    </li>
                                `);
                        }
                    } else {
                        alert("Failed to load products.");
                    }
                },
                error: function () {
                    alert("An error occurred while loading products.");
                }
            });
        }

        // Handle category click
        $(document).on('click', '.list-group-item', function () {
            currentCategoryId = $(this).data('category-id');
            loadProducts(currentCategoryId, 0);
        });

        // Handle pagination click
        $(document).on('click', '#pagination a', function (e) {
            e.preventDefault();
            let page = $(this).data('page');
            loadProducts(currentCategoryId, page);
        });
    });
</script>
</body>
</html>
